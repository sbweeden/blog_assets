<!DOCTYPE html>
<html>
  <head>
    <!-- 
        This page has been heavily customised for solicited passkey enrolment. 
        - Attestation options are refined for the platform authenticator. 
        - The excludeCredentials list, if any, is removed, allowing passkey overwrite on the client rather than a potential error
          if the user already had the platform passkey enroled but had logged in another way.
        - Instructions have been customised, tailored to the platform authenticator.
        - U2F registration link is removed.
        - The "Use another method" link is removed.
        - The post-registration-ceremony processing is modified (by defining a new success function) to allow auto-nickname-generation 
          of a passkey to be computed from introspecting the WebAuthn registration response, extracting the AAGUID and performing
          a lookup of well-known passkey providers.
      -->
    <title>$FIDO2_ENROLLMENT_TITLE$</title>
    <base href="/" />
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" type="image/x-icon" href="usc/favicon.ico" />
    <link rel="stylesheet" href="usc/css/stateless.css" />
    <link
      rel="stylesheet"
      href="/template/v1.0/static/theme.css?themeId=@THEME_ID@"
    />
    <script src="/authsvc/mtfim/sps/static/v1/jsrsasign-min.js"></script>
    <script src="/template/v1.0/static/js/cbor.js"></script>
    <script
      src="/template/v1.0/static/js/passkeyreg.js?themeId=@THEME_ID@"
      id="fido2-enrollment-script"
    >
      {
        "attestationOptions": @ATTESTATION_OPTIONS@,
        "errorMessage": "@ERROR_MESSAGE@",
        "showUseAnotherMethod": @SHOW_USE_ANOTHER_METHOD@,
        "nicknameError": "$FIDO2_ENROLLMENT_NAME_ERROR$",
        "isFallback": @FALLBACK@
      }
    </script>
  </head>
  <body>
    <div class="cs-content fido2-enrollment">
      @PAGE_HEADER@
      <div class="enrollment-heading-div">
        <h1>
          <!-- $FIDO2_ENROLLMENT_HEADING$ -->
          <div id="enrollmentHeadingDiv"></div>
        </h1>
        <h2 id="name-input">$FIDO2_ENROLLMENT_NAME_DEVICE$</h2>
      </div>
      <div id="instructions">
        <div class="content" id="list-instructions">
          <div id="instructionsTextDiv" class="instructions"></div>
        </div>
        <div class="platform-actions">
          <!-- This is new for allowing cancel -->
          <div id="abortlinkdiv">
            <div class="use-another-method" id="another-method1">
              <a id="abortPasskeyRegistrationHref"
                >Abort passkey registration</a
              >
            </div>
          </div>
          <button
            class="cs-button bx--btn bx--btn--primary"
            id="register-button"
          >
            Register a passkey
          </button>
          <!--
			  <div class="use-another-method" id="another-method1" style="position: absolute; top: 25px">
				 <a onclick="goBack()" href="javascript:void(0)">$FIDO2_ENROLLMENT_ANOTHER_METHOD$</a>
			  </div>
         -->
        </div>
        <div id="customErrorDiv">
          <div id="errorMsg"></div>
          <div id="errorMsgDetails"></div>
        </div>
      </div>

      <div class="content" id="enroll">
        <div class="instructions">$FIDO2_ENROLLMENT_NAME_INPUT$</div>
        <form id="register" method="POST" action="@ACTION@">
          <input
            placeholder="$FIDO2_ENROLLMENT_NICKNAME_PLACEHOLDER$"
            type="text"
            name="nickname"
            id="nickname"
            class="bx--text-input"
            autofocus
          />
          <input type="hidden" name="operation" value="register" />
          <input type="hidden" name="attestationResponse" value="" />
          <div id="cs-error-message-container" class="top-spaced error-message">
            <span id="cs-error-message">@ERROR_MESSAGE@</span>
          </div>
          <div class="platform-actions">
            <button
              class="cs-button bx--btn bx--btn--primary"
              id="verify-button"
            >
              Save Passkey
            </button>
            <!-- <button class="cs-button bx--btn bx--btn--primary" id="verify-button" onclick="registerFidoDevice(event)">$FIDO2_ENROLLMENT_VERIFY_DEVICE_BUTTON$</button> -->
            <div class="use-another-method" id="another-method2">
              <!-- <a onclick="goBack()" href="javascript:void(0)">$FIDO2_ENROLLMENT_ANOTHER_METHOD$</a> -->
            </div>
          </div>
        </form>
        <form id="use-another-method-form" action="@ACTION@" method="POST">
          <input name="operation" type="hidden" value="restart" />
        </form>
        <form id="fallback-form" action="@ACTION@" method="POST">
          <input name="operation" type="hidden" value="fallback" />
        </form>
      </div>
      @PAGE_FOOTER@
    </div>
  </body>
</html>